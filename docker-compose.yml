version: "3.8"

services:
  # 1. –°–µ—Ä–≤—ñ—Å –ë–∞–∑–∏ –î–∞–Ω–∏—Ö (PostgreSQL)
  db:
    image: postgres:15-alpine
    container_name: backend_db
    volumes:
      - db-data:/var/lib/postgresql/data
      - ./init_db:/docker-entrypoint-initdb.d
    environment:
      POSTGRES_USER: ${DB_USER}
      POSTGRES_PASSWORD: ${DB_PASSWORD}
      POSTGRES_DB: ${DB_NAME}
    ports:
      - "5432:5432"
    # –î–æ–¥–∞—î–º–æ env_file, —â–æ–± –ë–î —Ç–∞–∫–æ–∂ –º–æ–≥–ª–∞ –±–∞—á–∏—Ç–∏ –∑–º—ñ–Ω–Ω—ñ
    env_file:
      - .env
  
  # 2. –°–µ—Ä–≤—ñ—Å –í–µ–±-–∑–∞—Å—Ç–æ—Å—É–Ω–∫—É
  app:
    build: .
    container_name: backend_app
    ports:
      - "${PORT}:${PORT}"
      - "9229:9229" # –ü–æ—Ä—Ç –¥–ª—è –≤—ñ–¥–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è
    depends_on:
      - db
    env_file:
      - .env
    volumes:
      - .:/usr/src/app
      - /usr/src/app/node_modules # üí° –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –Ü–∑–æ–ª—é—î–º–æ node_modules
    command: nodemon --legacy-watch --inspect=0.0.0.0:9229 src/app.js

# –í–∏–∑–Ω–∞—á–∞—î–º–æ –Ω–∞–∑–≤—É Volume –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –ë–î
volumes:
  db-data:
